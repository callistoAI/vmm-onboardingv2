// Schema Verification Script
// This script verifies that the database payload matches the expected schema

// Expected payload from src/app/api/links/generate/route.ts
const expectedPayload = {
  admin_id: '00000000-0000-0000-0000-000000000001',
  link_name: 'Test Link Name', // This was causing the error
  token: 'generated-token-123',
  platforms: ['meta', 'google'],
  requested_permissions: {
    meta: ['pages_show_list'],
    google: ['openid', 'email', 'profile']
  },
  expires_at: '2024-12-31T23:59:59.000Z',
  status: 'pending'
};

// Expected database schema from OnboardingLink interface
const expectedSchema = {
  id: 'uuid (auto-generated)',
  admin_id: 'uuid (required)',
  client_id: 'uuid (optional)',
  link_name: 'text (optional)', // This must exist in database
  token: 'text (required, unique)',
  platforms: 'text[] (required)',
  requested_permissions: 'jsonb (required)',
  expires_at: 'timestamptz (required)',
  status: 'text (required)',
  created_at: 'timestamptz (auto-generated)',
  updated_at: 'timestamptz (auto-generated)'
};

console.log('‚úÖ Expected Payload Structure:');
console.log(JSON.stringify(expectedPayload, null, 2));

console.log('\n‚úÖ Expected Database Schema:');
console.log(JSON.stringify(expectedSchema, null, 2));

console.log('\nüîç Key Points:');
console.log('- link_name is OPTIONAL in interface but REQUIRED in payload');
console.log('- client_id is OPTIONAL and intentionally omitted from payload');
console.log('- id, created_at, updated_at are auto-generated by database');
console.log('- All other fields must match exactly between code and database');

console.log('\nüö® The Error:');
console.log('"Could not find the link_name column of onboarding_links in the schema cache"');
console.log('This means the database schema cache is outdated and needs to be refreshed.');

console.log('\nüí° Solution:');
console.log('Run the complete-platform-database-final.sql to refresh the schema cache.');
